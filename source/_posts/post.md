---
title: AWS各種サービスを組み合わせて社内サービスをサーバーレスなアーキテクチャで構築した話
date: 2017-10-22 22:00:25
categories:
  - development
author: me
layout: blog
---

# 目次
- やりたいこと、システム要件
- 構成
	- 構成図 with Cacoo
- 以下工夫したポイント
- 解説1: Hoge
- 解説2: Huga
- 解説3: docker-composeを使ってRubyコンテナ + Chromeコンテナにした

# 実現したいこと、システムへの要件
1. 限定されたユーザー（最大で100名程度）がアクセスするWebスクレイピング用のツール
2. スクレイピングするサイトはここでは明かさないが、IDとパスワードでログインして情報を取得＆何らかの操作を行うもの
	- イメージとしては、会員制の口コミ＆コミュニティサイト
	- 毎回パスワード入れてもらうのも面倒なので、各ユーザーのログイン情報をセキュアに保存する必要がある
3. スクレイピングの処理には「決められた時間に定期実行するもの」「各ユーザーが任意のタイミングで実行するもの」の2種類がある
4. スクレイピングが行われている様子を実際に目で見たい
5. ユーザーごとにスクレイピングの設定（例：ページを開く速度、スクレイピング対象のページリストなど）を保持したい
6. サーバー代などのランニングコストへの要求はそれほどシビアではない

# 作ったもの
上記の要件を実現するために、大きく分けて以下の2種類を実装しました。

今回工夫したポイントとしては、設計、インフラ構築から実装までほぼ自分1人で1ヶ月程度の期間で進めることになっていたので、メンテナンスする要素を減らし、かつ高速に開発できることを目指しました。

1. 管理画面
	- サインアップ/サインイン、スクレイピング処理の管理や環境設定などを行うための画面です。
	- サインアップできるユーザーを限定し、同時に後述するAWS CognitoによってセキュアにJavascriptから直接AWSのリソースにアクセスする構成が実現できます。
	- フレームワークにVue.jsを利用し、スクレイピング処理の実行状況をリアルタイムに反映する。
		- UIと呼べるほどのものはそれほどないですが、[keen-ui](https://github.com/JosephusPaye/Keen-UI)をUIコンポーネントとして使用しました
2. スクレイピング処理そのもの
	- やや複雑な処理を行う必要があった点、また筆者の経験から、Ruby + Capybara + Selenium WebDriver + Chromeでなるべく実ブラウザに近い環境を再現することにしました。メモリなどのリソースを食うことが予想されましたが、コストには比較的余裕があったため、上記のライブラリを使用することにしました。

# 全体構成